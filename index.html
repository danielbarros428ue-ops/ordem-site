<script>
const mapaPericias = {
"Acrobacia":"AGI",
"Adestramento":"PRE",
"Artes":"PRE",
"Atletismo":"FOR",
"Atualidades":"INT",
"Ciencias":"INT",
"Crime":"AGI",
"Diplomacia":"PRE",
"Enganacao":"PRE",
"Fortitude":"VIG",
"Furtividade":"AGI",
"Iniciativa":"AGI",
"Intimidacao":"PRE",
"Intuicao":"PRE",
"Investigacao":"INT",
"Luta":"FOR",
"Medicina":"INT",
"Ocultismo":"INT",
"Percepcao":"PRE",
"Pilotagem":"AGI",
"Pontaria":"AGI",
"Reflexos":"AGI",
"Religiao":"PRE",
"Sobrevivencia":"INT",
"Tecnologia":"INT",
"Vontade":"PRE"
};

let editando = null;

function salvar(){
    const nome = document.getElementById("nome").value;
    const FOR = Number(document.getElementById("for").value);
    const AGI = Number(document.getElementById("agi").value);
    const INT = Number(document.getElementById("int").value);
    const PRE = Number(document.getElementById("pre").value);
    const VIG = Number(document.getElementById("vig").value);

    const NEX = 10;

    if(!nome) return alert("Nome obrigatório");

    const personagem = {
        nome, FOR, AGI, INT, PRE, VIG, NEX,
        PV: 20 + VIG*5,
        PE: 10 + PRE*5
    };

    let lista = JSON.parse(localStorage.getItem("ordem")) || [];

    if(editando !== null){
        lista[editando] = personagem;
        editando = null;
    } else {
        lista.push(personagem);
    }

    localStorage.setItem("ordem", JSON.stringify(lista));
    limpar();
    carregar();
}

function calcularPericias(p){
    let html = "";
    for(let nome in mapaPericias){
        const atributo = mapaPericias[nome];
        const bonus = p[atributo] + Math.floor(p.NEX/10);
        html += `${nome}: +${bonus}<br>`;
    }
    return html;
}

function carregar(){
    const listaDiv = document.getElementById("lista");
    listaDiv.innerHTML = "";

    let lista = JSON.parse(localStorage.getItem("ordem")) || [];

    lista.forEach((p,i)=>{
        listaDiv.innerHTML += `
        <div class="personagem">
        <strong>${p.nome}</strong><br>
        PV: ${p.PV} | PE: ${p.PE}<br>
        NEX: ${p.NEX}%<br><br>
        FOR ${p.FOR} | AGI ${p.AGI} | INT ${p.INT} | PRE ${p.PRE} | VIG ${p.VIG}
        <br><br>
        <details>
        <summary>Ver Perícias</summary>
        ${calcularPericias(p)}
        </details>
        <br>
        <button onclick="editar(${i})">Editar</button>
        <button onclick="remover(${i})">Excluir</button>
        </div>
        `;
    });
}

function editar(i){
    let lista = JSON.parse(localStorage.getItem("ordem"));
    const p = lista[i];

    document.getElementById("nome").value = p.nome;
    document.getElementById("for").value = p.FOR;
    document.getElementById("agi").value = p.AGI;
    document.getElementById("int").value = p.INT;
    document.getElementById("pre").value = p.PRE;
    document.getElementById("vig").value = p.VIG;

    editando = i;
}

function remover(i){
    let lista = JSON.parse(localStorage.getItem("ordem"));
    lista.splice(i,1);
    localStorage.setItem("ordem", JSON.stringify(lista));
    carregar();
}

function limpar(){
    document.getElementById("nome").value="";
    document.getElementById("for").value="";
    document.getElementById("agi").value="";
    document.getElementById("int").value="";
    document.getElementById("pre").value="";
    document.getElementById("vig").value="";
}

carregar();
</script>
